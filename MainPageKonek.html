<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KONEK-ANI | Agri-Fishery e-Market</title>

<!-- Font & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

<style>
:root{
Â  --green-700: #11492f;
Â  --green-600: #166534;
Â  --green-500: #1f7a4c;
Â  --green-400: #22c55e;
Â  --muted: #6b7280;
Â  --bg: #f6fbf7;
Â  --card: #ffffff;
Â  --glass: rgba(255,255,255,0.85);
Â  --max-width: 1400px;
Â  --promo-height: 260px;
Â  font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}

/* Reset & layout */
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:var(--bg);color:#052e16;-webkit-font-smoothing:antialiased}
a{color:inherit;text-decoration:none}

/* --- COMMON STYLES FOR LOGIN/SIGNUP PAGES --- */
.auth-view-bg {
Â  Â  display: none; /* Hidden by default */
Â  Â  align-items: center;
Â  Â  justify-content: center;
Â  Â  height: 100vh;
Â  Â  width: 100%;
Â  Â  position: fixed;
Â  Â  top: 0;
Â  Â  left: 0;
Â  Â  z-index: 99; /* Above the main marketplace content */
Â  Â  opacity: 0;
Â  Â  pointer-events: none;
Â  Â  transition: opacity 0.3s ease-in-out;
}
.auth-view-bg.active {
Â  Â  display: flex;
Â  Â  opacity: 1;
Â  Â  pointer-events: auto;
}

/* Specific background styles */
#login-view.auth-view-bg {
Â  Â  background:url('https://images.unsplash.com/photo-1501004318641-b39e6451bec6?auto=format&fit=crop&w=1650&q=80') center/cover no-repeat;
}
#signup-view.auth-view-bg {
Â  Â  background:url('https://images.unsplash.com/photo-1471193945509-9ad0617afabf?auto=format&fit=crop&w=1650&q=80') center/cover no-repeat;
}

/* Login/Signup Card Styles */
.auth-card {
Â  background:var(--glass);
Â  backdrop-filter:blur(8px);
Â  border-radius:20px;
Â  padding:40px;
Â  max-width:420px;width:100%;
Â  box-shadow:0 8px 30px rgba(0,0,0,0.1);
Â  color: #11492f;
}
.auth-card h1{margin-top:0;color:var(--green-600);text-align:center;font-weight:800;font-size:2rem;}
.auth-card input, .auth-card select{
Â  width:100%;padding:12px;border:1px solid #d1d5db;border-radius:8px;margin-top:8px;margin-bottom:12px;
Â  background-color: white;
Â  color: #052e16;
}
.auth-card button{
Â  width:100%;padding:12px;border:0;border-radius:8px;
Â  background:linear-gradient(90deg,var(--green-600),var(--green-500));
Â  color:#fff;font-weight:700;margin-top:16px;cursor:pointer;
Â  transition: transform 0.1s;
}
.auth-card button:active { transform: scale(0.99); }
.auth-card a{color:var(--green-600);font-weight:700;text-decoration:none;}
.auth-card small{display:block;text-align:center;margin-top:10px;}
.auth-card label { display: block; font-weight: 600; font-size: 14px; color: var(--green-700); }


/* --- MARKETPLACE STYLES (Original) --- */

/* ---------- TWO-TIER HEADER (top strip) ---------- */
#marketplace-view{display: block; opacity: 1; transition: opacity 0.3s;}
.top-strip{
Â  background: linear-gradient(90deg, rgba(34,197,94,0.06), rgba(22,101,53,0.04));
Â  color:var(--green-700);
Â  font-size:13px;
Â  padding:6px 16px;
Â  border-bottom:1px solid rgba(17,73,47,0.04);
}
.top-strip .inner{max-width:var(--max-width);margin:0 auto;display:flex;justify-content:space-between;align-items:center;gap:12px}
.top-strip .left, .top-strip .right{display:flex;gap:12px;align-items:center}
.top-strip a{color:var(--green-700);opacity:.95}
.top-strip .muted{color:var(--muted);font-size:13px}

/* Notification badge beside the word "Notifications" */
.top-strip .notif { display:flex;align-items:center;gap:8px;font-weight:600;}
.top-strip .notif .badge { background:#ff5252;color:white;border-radius:999px;padding:3px 7px;font-size:12px;font-weight:700;}

/* Main header (search-centric) */
.main-header{
Â  background: linear-gradient(90deg, var(--green-600), var(--green-500));
Â  color:white;padding:12px 16px;
Â  box-shadow:0 3px 10px rgba(2,10,6,0.06);
Â  position:sticky;top:0;z-index:90;
}
.main-header .inner{max-width:var(--max-width);margin:0 auto;display:flex;align-items:center;gap:16px}
.brand{display:flex;align-items:center;gap:12px}
.brand .logo{
Â  width:56px;height:44px;border-radius:10px;background:linear-gradient(180deg,var(--green-700),var(--green-600));
Â  display:flex;align-items:center;justify-content:center;font-weight:800;color:white;font-size:16px;box-shadow:0 6px 18px rgba(8,40,24,0.18)
}
.brand .title{
Â  font-weight:800;font-size:20px;letter-spacing:0.6px;
Â  background: linear-gradient(90deg,#1f7a4c,#ffcc33); -webkit-background-clip:text; -webkit-text-fill-color:transparent;
Â  display:flex;align-items:center;gap:8px;
}
.brand .title img{width:20px;height:20px;filter:drop-shadow(0 1px 1px rgba(0,0,0,0.12))}

/* Search bar (Facebook/Shopee style) */
.search-bar{
Â  flex:1;max-width:820px;margin:0 12px;
Â  display:flex;align-items:center;background:white;border-radius:999px;padding:10px 14px;gap:12px;
Â  box-shadow:0 6px 20px rgba(3,16,12,0.08);
}
.search-bar input{border:0;outline:none;font-size:15px;width:100%;color: #052e16;}
.search-bar .cat-select{border:0;background:transparent;font-size:14px;color:#667967;margin-right:8px}

/* header actions */
.header-actions{display:flex;align-items:center;gap:12px;color:white}
.icon-btn{background:transparent;border:0;color:inherit;font-size:18px;cursor:pointer;padding:8px;border-radius:8px}
.icon-btn:hover{background:rgba(255,255,255,0.06)}

/* icon-with-badge patterns */
.icon-with-badge { position:relative; display:inline-flex; align-items:center; }
.icon-with-badge .count {
Â  position:absolute; top:-6px; right:-6px;
Â  background:#ff5252;color:white;border-radius:999px;padding:3px 6px;font-size:12px;font-weight:700;box-shadow:0 2px 6px rgba(0,0,0,0.2)
}

/* ---------- MAIN LAYOUT ---------- */
.layout{max-width:var(--max-width);margin:20px auto;padding:0 16px;display:grid;grid-template-columns:260px 1fr 320px;gap:20px}
@media (max-width:1100px){ .layout{grid-template-columns:1fr; padding:0 12px} .rightbar,.sidebar{position:static;} .main{order:2}}

/* LEFT SIDEBAR */
.sidebar{position:sticky;top:120px;align-self:start}
.sidebar .box{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 4px 12px rgba(2,10,6,0.04);margin-bottom:12px}
.sidebar h4{margin:0 0 8px;color:var(--green-600)}
.cat-list{display:flex;flex-direction:column;gap:8px}
.cat-item{display:flex;align-items:center;gap:10px;padding:8px;border-radius:8px;color:#05321b;cursor:pointer}
.cat-item:hover{background:#eef9ee}

/* filters in left sidebar */
.sidebar .filters { display:flex;flex-direction:column;gap:8px; margin-bottom:8px; }
.sidebar .filters select { padding:8px;border-radius:8px;border:1px solid #e6f6ec;background:white;font-size:14px; }

/* CENTER: FEED + MARKETPLACE */
.main{min-height:200px}
.feed{display:flex;flex-direction:column;gap:16px}
.post.card{display:block}
.post-head{display:flex;align-items:center;gap:12px}
.post-head img{width:48px;height:48px;border-radius:50%;object-fit:cover}
.post-meta small{display:block;color:var(--muted);font-size:13px}
.post-content{margin-top:8px;color:#0b2f19;line-height:1.4}
.post-content img{width:100%;border-radius:10px;margin-top:10px;display:block}

/* Promo slider (center, above feed) */
.promo-wrap{width:100%;margin-bottom:14px}
.promo-slider{position:relative;overflow:hidden;border-radius:12px;background:#fff;height:var(--promo-height);box-shadow:0 6px 18px rgba(2,10,6,0.06)}
.promo-track{display:flex;height:100%;width:400%;animation:promoSlide 12s linear infinite}
.promo-slide{flex:0 0 25%;height:100%;position:relative}
.promo-slide img{width:100%;height:100%;object-fit:cover;display:block}
@keyframes promoSlide{
Â  0%{transform:translateX(0%)}25%{transform:translateX(-25%)}50%{transform:translateX(-50%)}75%{transform:translateX(-75%)}100%{transform:translateX(0%)}
}

/* product grid & cards */
.section-title{display:flex;justify-content:space-between;align-items:center;margin-top:6px;margin-bottom:8px}
.product-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}
.product-card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 18px rgba(2,10,6,0.04);display:flex;flex-direction:column;gap:8px}
.product-card .media{width:100%;aspect-ratio:1/1;border-radius:8px;overflow:hidden}
.product-card img{width:100%;height:100%;object-fit:cover;display:block}
.product-card h4{margin:6px 0 0;font-size:15px}
.product-card .price{color:var(--green-600);font-weight:800}
.product-card .meta{font-size:13px;color:var(--muted)}
.product-card .chip{display:inline-block;padding:6px 8px;border-radius:999px;background:#f0fff4;color:var(--green-600);font-weight:600;font-size:12px}
.ctl-row{display:flex;gap:8px;align-items:center;margin-top:auto}
.btn-primary{flex:1;padding:8px;border:0;border-radius:8px;background:linear-gradient(90deg,var(--green-600),var(--green-500));color:white;font-weight:700;cursor:pointer}
.btn-outline{padding:8px;border-radius:8px;border:1px solid #e6f6ec;background:white;color:var(--green-600);cursor:pointer}

/* RIGHT BAR */
.rightbar .box{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 4px 12px rgba(2,10,6,0.04);margin-bottom:12px}
.rightbar h4{margin:0 0 8px;color:var(--green-600)}
.sensor{background:#f0fff4;padding:8px;border-radius:8px;font-size:13px;color:var(--green-600);margin:6px 0}
.trend-list{list-style:none;padding-left:14px;margin:0}
.trend-list li{margin:8px 0;color:#07361f}

/* footer */
.footer{margin:30px 0;text-align:center;color:var(--muted)}

/* responsive */
@media (max-width:900px){
Â  .layout{grid-template-columns:1fr}
Â  .brand .title{font-size:18px}
Â  .promo-slider{height:180px}
}
/* CUSTOM MESSAGE BOX (ALERT/CONFIRM REPLACEMENT) */
#custom-message-box {
Â  Â  display:none;Â 
Â  Â  position:fixed;Â 
Â  Â  top:50%;Â 
Â  Â  left:50%;Â 
Â  Â  transform:translate(-50%, -50%);Â 
Â  Â  background:white;Â 
Â  Â  padding:25px;Â 
Â  Â  border-radius:12px;Â 
Â  Â  box-shadow:0 10px 30px rgba(0,0,0,0.4);Â 
Â  Â  z-index:1000;Â 
Â  Â  max-width:90%;Â 
Â  Â  min-width:300px;Â 
Â  Â  text-align:center;
Â  Â  border: 1px solid var(--green-500);
}
#custom-message-box button {
Â  Â  padding: 10px 20px;
Â  Â  border: 0;
Â  Â  border-radius: 8px;
Â  Â  background: var(--green-600);
Â  Â  color: white;
Â  Â  font-weight: 600;
Â  Â  cursor: pointer;
Â  Â  margin-top: 10px;
}
</style>
</head>
<body>

<!-- CUSTOM MESSAGE BOX (REPLACES ALERT/CONFIRM) -->
<div id="custom-message-box" role="dialog" aria-modal="true" aria-labelledby="message-content">
Â  <p id="message-content" style="margin-bottom:15px; color:#052e16; font-size:16px;"></p>
Â  <button id="message-ok-btn">OK</button>Â 
</div>

<!-- Marketplace View -->
<div id="marketplace-view" style="display:none;">
Â  Â  <!-- TOP INFO STRIP -->
Â  Â  <div class="top-strip" aria-hidden="true">
Â  Â  Â  <div class="inner">
Â  Â  Â  Â  <div class="left">
Â  Â  Â  Â  Â  <span class="muted">Welcome to KONEK-ANI</span>
Â  Â  Â  Â  Â  <span style="margin-left:8px">â€¢</span>
Â  Â  Â  Â  Â  <a href="#" title="Seller center">Seller Center</a>
Â  Â  Â  Â  Â  <a href="#" title="Start selling">Start Selling</a>
Â  Â  Â  Â  Â  <a href="#" title="Download app">Download App</a>
Â  Â  Â  Â  Â  <a href="#" title="Follow us">Follow us ğŸŒ¾ğŸŸ</a>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="right" id="auth-unauthenticated">
Â  Â  Â  Â  Â  <!-- Notification word with badge beside it -->
Â  Â  Â  Â  Â  <a href="#" class="notif" title="Notifications">
Â  Â  Â  Â  Â  Â  <i class="fa-regular fa-bell" style="opacity:.9"></i>
Â  Â  Â  Â  Â  Â  <span style="font-weight:600;color:var(--green-700)">Notifications</span>
Â  Â  Â  Â  Â  Â  <span class="badge" style="background:#ff5252;color:#fff;padding:3px 7px;border-radius:999px;font-weight:700">3</span>
Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  <a href="#" title="Help"><i class="fa-regular fa-circle-question"></i> Help</a>
Â  Â  Â  Â  Â  <a href="#" data-action="login" title="Sign in" id="show-login-link">Sign In</a>Â 
Â  Â  Â  Â  Â  <a href="#" data-action="signup" title="Sign up" style="padding:6px 10px;border-radius:8px;background:linear-gradient(90deg,var(--green-600),var(--green-500));color:white" id="show-signup-link">Sign Up</a>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <!-- MAIN HEADER -->
Â  Â  <header class="main-header" role="banner">
Â  Â  Â  <div class="inner">
Â  Â  Â  Â  <div class="brand">
Â  Â  Â  Â  Â  <div class="logo">K</div>
Â  Â  Â  Â  Â  <div class="title"><img src="https://cdn-icons-png.flaticon.com/512/7662/7662138.png" alt="leaf"> KONEK-ANI</div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="search-bar" role="search" aria-label="Search">
Â  Â  Â  Â  Â  <i class="fa-solid fa-magnifying-glass" style="color:#8fbf96;font-size:18px"></i>
Â  Â  Â  Â  Â  <input placeholder="Search for agri-fishery products, sellers and updates..." aria-label="Search input">
Â  Â  Â  Â  Â  <select class="cat-select" aria-label="Category">
Â  Â  Â  Â  Â  Â  <option value="">All categories</option>
Â  Â  Â  Â  Â  Â  <option>Rice & Grains</option>
Â  Â  Â  Â  Â  Â  <option>Fish & Seafood</option>
Â  Â  Â  Â  Â  Â  <option>Vegetables</option>
Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  <button class="btn-primary" style="padding:8px 12px;border-radius:8px">Search</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="header-actions" aria-hidden="false">
Â  Â  Â  Â  Â  <button class="icon-btn" title="Wishlist"><i class="fa-regular fa-heart"></i></button>

Â  Â  Â  Â  Â  <!-- cart icon with its badge near the icon -->
Â  Â  Â  Â  Â  <div class="icon-with-badge" title="Cart" style="margin-right:6px">
Â  Â  Â  Â  Â  Â  <button class="icon-btn"><i class="fa-solid fa-cart-shopping"></i></button>
Â  Â  Â  Â  Â  Â  <span class="count">2</span>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <!-- small notifications icon (top-strip already has label+badge) -->
Â  Â  Â  Â  Â  <div class="icon-with-badge" title="Notifications">
Â  Â  Â  Â  Â  Â  <button class="icon-btn"><i class="fa-regular fa-bell"></i></button>
Â  Â  Â  Â  Â  Â  <span class="count">3</span>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <!-- Authenticated User Profile (Hidden by default) -->
Â  Â  Â  Â  Â  <div id="auth-authenticated" style="display:none;align-items:center;gap:8px;color:white">
Â  Â  Â  Â  Â  Â  <a href="#" title="Seller Dashboard" style="display:flex;align-items:center;gap:8px;color:white">
Â  Â  Â  Â  Â  Â  Â  Â  <img id="profile-pic" src="https://placehold.co/36x36/166534/ffffff?text=U" alt="profile" style="width:36px;height:36px;border-radius:50%;object-fit:cover;border:2px solid rgba(255,255,255,0.12)">
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  <button id="logout-btn" class="icon-btn" title="Logout" style="color:white;margin-left:4px;"><i class="fa-solid fa-right-from-bracket"></i></button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </header>

Â  Â  <!-- MAIN PAGE LAYOUT -->
Â  Â  <div class="layout" role="main">

Â  Â  Â  <!-- LEFT: FILTERS, CATEGORIES & QUICK LINKS -->
Â  Â  Â  <aside class="sidebar" aria-label="Categories & quick links">

Â  Â  Â  Â  <!-- Filters (above categories) -->
Â  Â  Â  Â  <div class="box">
Â  Â  Â  Â  Â  <h4>Filters</h4>
Â  Â  Â  Â  Â  <div class="filters">
Â  Â  Â  Â  Â  Â  <label style="font-size:13px;color:var(--muted)">Region:</label>
Â  Â  Â  Â  Â  Â  <select id="region" aria-label="Region">
Â  Â  Â  Â  Â  Â  Â  <option value="">Select Region</option>
Â  Â  Â  Â  Â  Â  Â  <option value="Region IX">Region IX (Zamboanga Peninsula)</option>
Â  Â  Â  Â  Â  Â  Â  <option value="Region X">Region X (Northern Mindanao)</option>
Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  <label style="font-size:13px;color:var(--muted)">Province:</label>
Â  Â  Â  Â  Â  Â  <select id="province" aria-label="Province">
Â  Â  Â  Â  Â  Â  Â  <option value="">Select Province</option>
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <!-- Categories -->
Â  Â  Â  Â  <div class="box">
Â  Â  Â  Â  Â  <h4>Categories</h4>
Â  Â  Â  Â  Â  <nav class="cat-list" aria-label="Product categories">
Â  Â  Â  Â  Â  Â  <div class="cat-item">ğŸŒ¾ Rice & Grains</div>
Â  Â  Â  Â  Â  Â  <div class="cat-item">ğŸŸ Fish & Seafood</div>
Â  Â  Â  Â  Â  Â  <div class="cat-item">ğŸ¥¬ Vegetables</div>
Â  Â  Â  Â  Â  Â  <div class="cat-item">ğŸ‰ Fruits</div>
Â  Â  Â  Â  Â  Â  <div class="cat-item">ğŸŒ± Seeds</div>
Â  Â  Â  Â  Â  Â  <div class="cat-item">ğŸšœ Farm Tools</div>
Â  Â  Â  Â  Â  </nav>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <!-- Quick Links -->
Â  Â  Â  Â  <div class="box">
Â  Â  Â  Â  Â  <h4>Quick Links</h4>
Â  Â  Â  Â  Â  <a href="#" style="display:block;padding:8px;border-radius:8px">ğŸ“¦ Sell on KONEK-ANI</a>
Â  Â  Â  Â  Â  <a href="#" style="display:block;padding:8px;border-radius:8px">ğŸ§¾ Order History</a>
Â  Â  Â  Â  Â  <a href="#" style="display:block;padding:8px;border-radius:8px">ğŸ· Bulk Deals</a>
Â  Â  Â  Â  </div>
Â  Â  Â  </aside>

Â  Â  Â  <!-- CENTER: FEED + MARKETPLACE -->
Â  Â  Â  <section class="main" aria-label="Feed and product listings">
Â  Â  Â  Â  <div class="feed">

Â  Â  Â  Â  Â  <!-- PROMO SLIDER (center, above feed & marketplace picks) -->
Â  Â  Â  Â  Â  <div class="promo-wrap">
Â  Â  Â  Â  Â  Â  <div class="promo-slider" aria-hidden="true">
Â  Â  Â  Â  Â  Â  Â  <div class="promo-track" id="promoTrack">
Â  Â  Â  Â  Â  Â  Â  Â  <!-- 4 sample promo images -->
Â  Â  Â  Â  Â  Â  Â  Â  <div class="promo-slide"><img src="https://images.unsplash.com/photo-1524594154908-edd3360a0d5e?w=1600&q=80&auto=format&fit=crop" alt="Rice field"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="promo-slide"><img src="https://images.unsplash.com/photo-1504754524776-8f4f37790ca0?w=1600&q=80&auto=format&fit=crop" alt="Fresh vegetables"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="promo-slide"><img src="https://images.unsplash.com/photo-1600788913311-6c7ad781f5c1?w=1600&q=80&auto=format&fit=crop" alt="Seafood market"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="promo-slide"><img src="https://images.unsplash.com/photo-1501004318641-b39e6451bec6?w=1600&q=80&auto=format&fit=crop" alt="Fruits"></div>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <!-- SOCIAL FEED POSTS -->
Â  Â  Â  Â  Â  <article class="card post" aria-labelledby="post-1">
Â  Â  Â  Â  Â  Â  <div class="post-head">
Â  Â  Â  Â  Â  Â  Â  <img src="https://randomuser.me/api/portraits/men/12.jpg" alt="Juan">
Â  Â  Â  Â  Â  Â  Â  <div class="post-meta">
Â  Â  Â  Â  Â  Â  Â  Â  <strong id="post-1">Juan Dela Cruz</strong>
Â  Â  Â  Â  Â  Â  Â  Â  <small class="muted">Farmer Â· 2 hours ago Â· Zamboanga</small>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="post-content">
Â  Â  Â  Â  Â  Â  Â  Fresh harvest alert â€” premium organic rice now available for bulk purchase. Minimum 500kg. DM for samples.
Â  Â  Â  Â  Â  Â  Â  <img src="https://images.unsplash.com/photo-1607083206173-37eb2caeeb7d?w=1200&q=80&auto=format&fit=crop" alt="rice field">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </article>

Â  Â  Â  Â  Â  <article class="card post" aria-labelledby="post-2">
Â  Â  Â  Â  Â  Â  <div class="post-head">
Â  Â  Â  Â  Â  Â  Â  <img src="https://randomuser.me/api/portraits/women/45.jpg" alt="Maria">
Â  Â  Â  Â  Â  Â  Â  <div class="post-meta">
Â  Â  Â  Â  Â  Â  Â  Â  <strong id="post-2">Maria Santos</strong>
Â  Â  Â  Â  Â  Â  Â  Â  <small class="muted">Retailer Â· 4 hours ago Â· Dipolog</small>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="post-content">
Â  Â  Â  Â  Â  Â  Â  Fresh bangus delivered today â€” firm texture, best for grilling. Available in 10â€“20kg boxes.
Â  Â  Â  Â  Â  Â  Â  <img src="https://images.unsplash.com/photo-1616486338812-3e96d8c36f53?w=1200&q=80&auto=format&fit=crop" alt="bangus">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </article>

Â  Â  Â  Â  Â  <!-- MARKETPLACE GRID HEADER -->
Â  Â  Â  Â  Â  <div class="section-title">
Â  Â  Â  Â  Â  Â  <h3 style="margin:0;color:var(--green-600)">Marketplace Picks</h3>
Â  Â  Â  Â  Â  Â  <div class="muted">Bulk & retail from trusted sellers</div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="product-grid" aria-live="polite" id="market-grid">
Â  Â  Â  Â  Â  Â  <!-- Product cards (sample) -->
Â  Â  Â  Â  Â  Â  <div class="product-card" data-region="Region IX" data-province="Zamboanga del Sur" style="display:flex">
Â  Â  Â  Â  Â  Â  Â  <div class="media"><img src="https://images.unsplash.com/photo-1607083206173-37eb2caeeb7d?w=900&q=80&auto=format&fit=crop" alt="organic rice"></div>
Â  Â  Â  Â  Â  Â  Â  <h4>Organic White Rice (Premium)</h4>
Â  Â  Â  Â  Â  Â  Â  <div class="meta">Zamboanga del Sur</div>
Â  Â  Â  Â  Â  Â  Â  <div class="price">â‚± 45 / kg</div>
Â  Â  Â  Â  Â  Â  Â  <div class="chip">Low water usage</div>
Â  Â  Â  Â  Â  Â  Â  <div class="ctl-row">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-primary" data-action="contact-seller" data-info="0999-111-2222">Contact Seller</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-outline" data-action="favorite" data-id="1"><i class="fa-regular fa-heart"></i></button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="product-card" data-region="Region IX" data-province="Zamboanga del Norte" style="display:flex">
Â  Â  Â  Â  Â  Â  Â  <div class="media"><img src="https://images.unsplash.com/photo-1616486338812-3e96d8c36f53?w=900&q=80&auto=format&fit=crop" alt="bangus"></div>
Â  Â  Â  Â  Â  Â  Â  <h4>Fresh Bangus (Milkfish)</h4>
Â  Â  Â  Â  Â  Â  Â  <div class="meta">Zamboanga del Norte</div>
Â  Â  Â  Â  Â  Â  Â  <div class="price">â‚± 180 / kg</div>
Â  Â  Â  Â  Â  Â  Â  <div class="chip">Responsible feed</div>
Â  Â  Â  Â  Â  Â  Â  <div class="ctl-row">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-primary" data-action="contact-seller" data-info="0999-333-4444">Contact Seller</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-outline" data-action="favorite" data-id="2"><i class="fa-regular fa-heart"></i></button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="product-card" data-region="Region X" data-province="Misamis Occidental" style="display:flex">
Â  Â  Â  Â  Â  Â  Â  <div class="media"><img src="https://images.unsplash.com/photo-1501004318641-b39e6451bec6?w=900&q=80&auto=format&fit=crop" alt="tomatoes"></div>
Â  Â  Â  Â  Â  Â  Â  <h4>Tomatoes (Local)</h4>
Â  Â  Â  Â  Â  Â  Â  <div class="meta">Misamis Occidental</div>
Â  Â  Â  Â  Â  Â  Â  <div class="price">â‚± 55 / kg</div>
Â  Â  Â  Â  Â  Â  Â  <div class="chip">Organic</div>
Â  Â  Â  Â  Â  Â  Â  <div class="ctl-row">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-primary" data-action="contact-seller" data-info="0999-222-3333">Contact Seller</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-outline" data-action="favorite" data-id="3"><i class="fa-regular fa-heart"></i></button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div>
Â  Â  Â  </section>

Â  Â  Â  <!-- RIGHT: TRENDING, WEATHER & SENSORS, PROMOS -->
Â  Â  Â  <aside class="rightbar" aria-label="Trending and sensors">
Â  Â  Â  Â  <div class="box card">
Â  Â  Â  Â  Â  <h4>Trending Products</h4>
Â  Â  Â  Â  Â  <ul class="trend-list" aria-hidden="true">
Â  Â  Â  Â  Â  Â  <li>ğŸ  Tilapia â€” â‚±150/kg</li>
Â  Â  Â  Â  Â  Â  <li>ğŸŒ½ Organic Corn â€” â‚±38/kg</li>
Â  Â  Â  Â  Â  Â  <li>ğŸ¦€ Mud Crab â€” â‚±830/kg</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="box card">
Â  Â  Â  Â  Â  <h4>Weather & Farm Sensors</h4>
Â  Â  Â  Â  Â  <div class="sensor">â˜€ï¸ Temp: 31 Â°C</div>
Â  Â  Â  Â  Â  <div class="sensor">ğŸ’§ Humidity: 75%</div>
Â  Â  Â  Â  Â  <div class="sensor">ğŸŒ¾ Soil Moisture: 61%</div>
Â  Â  Â  Â  Â  <div style="margin-top:12px"><button class="btn-primary" style="width:100%" data-action="view-insights">View Insights</button></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="box card">
Â  Â  Â  Â  Â  <h4>Promotions</h4>
Â  Â  Â  Â  Â  <p class="muted" style="margin:6px 0">Bulk buyers: get 5% off rice orders above 5,000kg. Contact sales.</p>
Â  Â  Â  Â  Â  <button class="btn-outline" style="width:100%" data-action="view-promotions">View All</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </aside>
Â  Â  </div>

Â  Â  <div class="footer">Â© 2025 KONEK-ANI Â· Agri-Fishery Digital Marketplace ğŸŒ¿</div>

</div>

<!-- Login View (Hidden by default) -->
<div id="login-view" class="auth-view-bg active">
Â  <div class="auth-card">
Â  Â  <h1>KONEK-ANI Login</h1>
Â  Â  <form id="login-form">
Â  Â  Â  <label>Email</label>
Â  Â  Â  <input id="login-email" type="email" required>
Â  Â  Â  <label>Password</label>
Â  Â  Â  <input id="login-password" type="password" required>
Â  Â  Â  <button type="submit">Login</button>
Â  Â  Â  <small>Donâ€™t have an account? <a href="#" data-action="signup-from-login">Sign up</a></small>
Â  Â  Â  <small style="margin-top:20px;"><a href="#" data-action="marketplace-from-login">Go back to Marketplace</a></small>
Â  Â  </form>
Â  </div>
</div>

<!-- Sign Up View (Hidden by default) -->
<div id="signup-view" class="auth-view-bg">
Â  <div class="auth-card">
Â  Â  <h1>Create Account</h1>
Â  Â  <form id="signup-form">
Â  Â  Â  <label>Full Name</label>
Â  Â  Â  <input id="signup-name" type="text" required>
Â  Â  Â  <label>Email</label>
Â  Â  Â  <input id="signup-email" type="email" required>
Â  Â  Â  <label>Password (min 6 characters)</label>
Â  Â  Â  <input id="signup-password" type="password" required minlength="6">
Â  Â  Â  <label>Account Type</label>
Â  Â  Â  <select id="signup-account-type">
Â  Â  Â  Â  <option>Farmer</option>
Â  Â  Â  Â  <option>Retailer</option>
Â  Â  Â  Â  <option>Wholesaler</option>
Â  Â  Â  </select>
Â  Â  Â  <button type="submit" id="signup-submit-btn">Sign Up</button>
Â  Â  Â  <small>Already have an account? <a href="#" data-action="login-from-signup">Login</a></small>
Â  Â  Â  <small style="margin-top:20px;"><a href="#" data-action="marketplace-from-signup">Go back to Marketplace</a></small>
Â  Â  </form>
Â  </div>
</div>

<script type="module">
Â  // --- FIREBASE IMPORTS ---
Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
Â  import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
Â  import { getFirestore, doc, setDoc, collection, serverTimestamp, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
Â  import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

Â  // --- START DEBUG LOG ---
Â  console.log('*** KONEK-ANI: Script starting... ***');
Â  setLogLevel('debug'); // Enable Firestore logs for debugging

Â  // --- FIREBASE CONFIGURATION (Using global environment variables) ---
Â  const appId = typeof __app_id !== 'undefined' ? __app_id : 'konek-ani-repository';
Â  const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {}; // Fallback empty object
Â  const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
Â Â 
Â  // --- FIREBASE INITIALIZATION ---
Â  const app = initializeApp(firebaseConfig);
Â  const auth = getAuth(app);
Â  const db = getFirestore(app);
Â Â 
Â  let currentUserId = null;
Â Â 
Â  // Sign in with custom token or anonymously
Â  async function authenticate() {
Â  Â  Â  try {
Â  Â  Â  Â  Â  if (initialAuthToken) {
Â  Â  Â  Â  Â  Â  Â  await signInWithCustomToken(auth, initialAuthToken);
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  await signInAnonymously(auth);
Â  Â  Â  Â  Â  }
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  console.error("Firebase initial authentication failed:", error);Â 
Â  Â  Â  }
Â  }

Â  // --- VIEW MANAGEMENT & CUSTOM MESSAGE BOX ---
Â  const marketplaceView = document.getElementById('marketplace-view');
Â  const loginView = document.getElementById('login-view');
Â  const signupView = document.getElementById('signup-view');
Â  const unauthHeader = document.getElementById('auth-unauthenticated');
Â  const authHeader = document.getElementById('auth-authenticated');
Â  const profilePic = document.getElementById('profile-pic');
Â  const messageBox = document.getElementById('custom-message-box');
Â  const messageContent = document.getElementById('message-content');
Â  const messageOkBtn = document.getElementById('message-ok-btn');
Â Â 
Â  // Global View Function
Â  const showView = (viewName) => {
Â  Â  Â  // Hide all views first
Â  Â  Â  marketplaceView.style.display = 'none';
Â  Â  Â  loginView.classList.remove('active');
Â  Â  Â  signupView.classList.remove('active');

Â  Â  Â  if (viewName === 'marketplace') {
Â  Â  Â  Â  Â  marketplaceView.style.display = 'block';
Â  Â  Â  } else if (viewName === 'login') {
Â  Â  Â  Â  Â  loginView.classList.add('active');
Â  Â  Â  } else if (viewName === 'signup') {
Â  Â  Â  Â  Â  signupView.classList.add('active');
Â  Â  Â  }
Â  };
Â Â 
Â  // Global Custom Alert Function
Â  const showCustomMessage = (message) => {
Â  Â  Â  messageContent.textContent = message;
Â  Â  Â  messageBox.style.display = 'block';
Â  };
Â Â 
Â  // Handle OK button click on custom message box
Â  messageOkBtn.addEventListener('click', () => {
Â  Â  messageBox.style.display = 'none';
Â  });

Â  // --- AUTH STATE LISTENER & UI UPDATE ---
Â  onAuthStateChanged(auth, async (user) => {
Â  Â  Â  if (user && !user.isAnonymous) {
Â  Â  Â  Â  Â  // Authenticated User
Â  Â  Â  Â  Â  currentUserId = user.uid;
Â  Â  Â  Â  Â  unauthHeader.style.display = 'none';
Â  Â  Â  Â  Â  authHeader.style.display = 'flex';
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // Fetch user data from Firestore for profile info
Â  Â  Â  Â  Â  // Path: /artifacts/{appId}/users/{userId}/user_profile/data
Â  Â  Â  Â  Â  const userDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}/user_profile/data`);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const docSnap = await getDoc(userDocRef);
Â  Â  Â  Â  Â  Â  if (docSnap.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  const userData = docSnap.data();
Â  Â  Â  Â  Â  Â  Â  Â  const initial = userData.fullName ? userData.fullName.charAt(0).toUpperCase() : 'U';
Â  Â  Â  Â  Â  Â  Â  Â  profilePic.src = `https://placehold.co/36x36/166534/ffffff?text=${initial}`;
Â  Â  Â  Â  Â  Â  Â  Â  profilePic.alt = userData.fullName || 'User Profile';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  profilePic.src = `https://placehold.co/36x36/166534/ffffff?text=${user.email ? user.email.charAt(0).toUpperCase() : 'U'}`;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  console.error("Error fetching user profile data:", e);
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  // If the user logs in, ensure we are on the marketplace
Â  Â  Â  Â  Â  if (loginView.classList.contains('active') || signupView.classList.contains('active')) {
Â  Â  Â  Â  Â  Â  Â  showView('marketplace');
Â  Â  Â  Â  Â  }

Â  Â  Â  } else {
Â  Â  Â  Â  Â  // Unauthenticated or Anonymous User
Â  Â  Â  Â  Â  currentUserId = null;
Â  Â  Â  Â  Â  unauthHeader.style.display = 'flex';
Â  Â  Â  Â  Â  authHeader.style.display = 'none';
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // If the user logs out, or is anonymous, force to login view to prompt registration
Â  Â  Â  Â  Â  if (user && user.isAnonymous) {
Â  Â  Â  Â  Â  Â  Â  // Anonymous user is treated like logged out for this workflow
Â  Â  Â  Â  Â  Â  Â  showView('login');
Â  Â  Â  Â  Â  } else if (marketplaceView.style.display !== 'none') {
Â  Â  Â  Â  Â  Â  Â  // If they were viewing marketplace and got logged out
Â  Â  Â  Â  Â  Â  Â  showView('login');
Â  Â  Â  Â  Â  }
Â  Â  Â  }
Â  });

Â  // --- AUTHENTICATION HANDLERS ---
Â Â 
Â  // Sign Up Handler
Â  const handleSignUp = async (e) => {
Â  Â  Â  e.preventDefault();
Â  Â  Â  const name = document.getElementById('signup-name').value.trim();
Â  Â  Â  const email = document.getElementById('signup-email').value.trim();
Â  Â  Â  const password = document.getElementById('signup-password').value;
Â  Â  Â  const accountType = document.getElementById('signup-account-type').value;

Â  Â  Â  if (password.length < 6) {
Â  Â  Â  Â  showCustomMessage("Password must be at least 6 characters long.");
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â  if (!name || !email || !password) {
Â  Â  Â  Â  showCustomMessage("Please fill in all required fields.");
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  try {
Â  Â  Â  Â  Â  // 1. Create user account in Firebase Auth
Â  Â  Â  Â  Â  const userCredential = await createUserWithEmailAndPassword(auth, email, password);
Â  Â  Â  Â  Â  const user = userCredential.user;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  // 2. Save additional user data to Firestore (the "repository")
Â  Â  Â  Â  Â  const userDocRef = doc(db, `artifacts/${appId}/users/${user.uid}/user_profile/data`);
Â  Â  Â  Â  Â  await setDoc(userDocRef, {
Â  Â  Â  Â  Â  Â  Â  fullName: name,
Â  Â  Â  Â  Â  Â  Â  accountType: accountType,
Â  Â  Â  Â  Â  Â  Â  email: email,
Â  Â  Â  Â  Â  Â  Â  createdAt: serverTimestamp()
Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  showCustomMessage(`Welcome, ${name}! Your ${accountType} account has been created successfully. You are now logged in.`);
Â  Â  Â  Â  Â  // onAuthStateChanged handles the view switch
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  let errorMessage = "Sign Up Failed: An unknown error occurred.";
Â  Â  Â  Â  Â  if (error.code === 'auth/email-already-in-use') {
Â  Â  Â  Â  Â  Â  Â  errorMessage = "Sign Up Failed: This email is already registered. Try logging in.";
Â  Â  Â  Â  Â  } else if (error.code === 'auth/weak-password') {
Â  Â  Â  Â  Â  Â  Â  errorMessage = "Sign Up Failed: Password is too weak (min 6 characters).";
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  errorMessage = `Sign Up Failed: ${error.message.replace('Firebase: ', '')}`;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  showCustomMessage(errorMessage);
Â  Â  Â  }
Â  };
Â Â 
Â  // Login Handler (Cross-examines credentials in the auth repository)
Â  const handleLogin = async (e) => {
Â  Â  Â  e.preventDefault();
Â  Â  Â  const email = document.getElementById('login-email').value.trim();
Â  Â  Â  const password = document.getElementById('login-password').value;

Â  Â  Â  try {
Â  Â  Â  Â  Â  await signInWithEmailAndPassword(auth, email, password);
Â  Â  Â  Â  Â  showCustomMessage("Login successful! Welcome back.");
Â  Â  Â  Â  Â  // onAuthStateChanged handles the view switch
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  let errorMessage = "Login Failed: Check your email and password.";
Â  Â  Â  Â  Â  if (error.code === 'auth/invalid-credential' || error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
Â  Â  Â  Â  Â  Â  Â  errorMessage = "Login Failed: Invalid email or password.";
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  errorMessage = `Login Failed: ${error.message.replace('Firebase: ', '')}`;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  showCustomMessage(errorMessage);
Â  Â  Â  }
Â  };

Â  // Logout Handler
Â  const handleLogout = async () => {
Â  Â  Â  try {
Â  Â  Â  Â  Â  await signOut(auth);
Â  Â  Â  Â  Â  showCustomMessage("You have been successfully logged out.");
Â  Â  Â  Â  Â  // onAuthStateChanged handles the view switch
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  console.error("Logout error:", error);
Â  Â  Â  Â  Â  showCustomMessage("Logout Failed. Please try again.");
Â  Â  Â  }
Â  };

Â  // Attach Auth Handlers
Â  document.getElementById('signup-form')?.addEventListener('submit', handleSignUp);
Â  document.getElementById('login-form')?.addEventListener('submit', handleLogin);
Â  document.getElementById('logout-btn')?.addEventListener('click', handleLogout);


Â  // --- MARKETPLACE FILTERING LOGIC (Completed from previous state) ---
Â  const provinces = {
Â  Â  "Region IX": ["Zamboanga del Sur", "Zamboanga del Norte", "Zamboanga Sibugay"],
Â  Â  "Region X": ["Misamis Occidental", "Misamis Oriental", "Bukidnon"]
Â  };

Â  const updateProvinces = () => {
Â  Â  const regionSelect = document.getElementById("region");
Â  Â  const provinceSelect = document.getElementById("province");
Â  Â  const region = regionSelect ? regionSelect.value : '';

Â  Â  provinceSelect.innerHTML = '<option value="">Select Province</option>';
Â  Â  if (provinces[region]) {
Â  Â  Â  provinces[region].forEach(p => {
Â  Â  Â  Â  const opt = document.createElement("option");
Â  Â  Â  Â  opt.value = p;
Â  Â  Â  Â  opt.textContent = p;
Â  Â  Â  Â  provinceSelect.appendChild(opt);
Â  Â  Â  });
Â  Â  }
Â  Â  filterProducts();
Â  };

Â  const filterProducts = () => {
Â  Â  const regionSelect = document.getElementById("region");
Â  Â  const provinceSelect = document.getElementById("province");
Â  Â Â 
Â  Â  if (!regionSelect || !provinceSelect) return;
Â  Â Â 
Â  Â  const region = regionSelect.value;
Â  Â  const province = provinceSelect.value;
Â  Â Â 
Â  Â  document.querySelectorAll(".product-card").forEach(card => {
Â  Â  Â  Â  Â  const cardRegion = card.dataset.region;
Â  Â  Â  Â  Â  const cardProvince = card.dataset.province;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  let isVisible = true;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  if (region && cardRegion !== region) {
Â  Â  Â  Â  Â  Â  Â  isVisible = false;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  if (province && cardProvince !== province) {
Â  Â  Â  Â  Â  Â  Â  isVisible = false;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  card.style.display = isVisible ? 'flex' : 'none';
Â  Â  Â  });
Â  };
Â Â 
Â  // Attach listeners for marketplace filters
Â  document.getElementById("region")?.addEventListener('change', updateProvinces);
Â  document.getElementById("province")?.addEventListener('change', filterProducts);
Â Â 
Â Â 
Â  // --- GENERAL EVENT DELEGATION FOR VIEW SWITCHING AND BUTTONS ---
Â  document.body.addEventListener('click', (e) => {
Â  Â  Â  const target = e.target.closest('[data-action]');
Â  Â  Â  if (!target) return;
Â  Â  Â Â 
Â  Â  Â  const action = target.dataset.action;
Â  Â  Â Â 
Â  Â  Â  // Prevent default link behavior for internal actions
Â  Â  Â  e.preventDefault();
Â  Â  Â Â 
Â  Â  Â  if (action === 'login' || action === 'login-from-signup') {
Â  Â  Â  Â  Â  showView('login');
Â  Â  Â  } else if (action === 'signup' || action === 'signup-from-login') {
Â  Â  Â  Â  Â  showView('signup');
Â  Â  Â  } else if (action.startsWith('marketplace')) {
Â  Â  Â  Â  Â  showView('marketplace');
Â  Â  Â  } else if (action === 'contact-seller' || action === 'favorite') {
Â  Â  Â  Â  Â  // Check if user is logged in (not anonymous)
Â  Â  Â  Â  Â  if (auth.currentUser && !auth.currentUser.isAnonymous) {
Â  Â  Â  Â  Â  Â  Â  if (action === 'contact-seller') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  const info = target.dataset.info || 'N/A';
Â  Â  Â  Â  Â  Â  Â  Â  Â  showCustomMessage(`Seller Contact Info: ${info}. Use respectfully!`);
Â  Â  Â  Â  Â  Â  Â  } else if (action === 'favorite') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  showCustomMessage(`Product ${target.dataset.id} added to your favorites!`);
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  showCustomMessage("You must be logged in to perform this action. Please sign in or sign up first.");
Â  Â  Â  Â  Â  Â  Â  showView('login');
Â  Â  Â  Â  Â  }
Â  Â  Â  }
Â  });


Â  // --- INITIALIZATION ---
Â  // Run initial authentication check
Â  authenticate();
Â  // Ensure the initial view is the login page before the auth state resolves
Â  showView('login');
</script>
